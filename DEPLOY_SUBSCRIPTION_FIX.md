# –î–µ–ø–ª–æ–π: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫

## ‚úÖ –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è

**–î–∞—Ç–∞:** 2025-12-09  
**–í—Ä–µ–º—è:** 17:11 (UTC+3)  
**–ö–æ–º–º–∏—Ç:** a149ba7

## üì¶ –ß—Ç–æ –±—ã–ª–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase) ‚úÖ
- **–ú–∏–≥—Ä–∞—Ü–∏—è:** `fix_payment_constraint`
- **–°—Ç–∞—Ç—É—Å:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω constraint –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `payments`

### 2. –ö–æ–¥ (Git + Vercel) ‚úÖ
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** github.com:veo3kipish-max/rerer.git
- **–í–µ—Ç–∫–∞:** main
- **–ö–æ–º–º–∏—Ç:** a149ba7
- **Vercel:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω

### 3. –§–∞–π–ª—ã
- ‚úÖ `supabase/schema.sql` - –æ–±–Ω–æ–≤–ª–µ–Ω constraint
- ‚úÖ `SUBSCRIPTION_FIX.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `–ö–ê–ö_–ö–£–ü–ò–¢–¨_–ü–û–î–ü–ò–°–ö–£.md` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üîç –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –°—Ç–∞—Ä—ã–π constraint (–£–î–ê–õ–Å–ù):
CHECK (
  (type = 'subscription' AND tier IS NOT NULL AND credits IS NULL)
  OR 
  (type = 'credits' AND credits IS NOT NULL AND tier IS NULL)
)

-- –ù–æ–≤—ã–π constraint (–î–û–ë–ê–í–õ–ï–ù):
CHECK (
  (type = 'subscription' AND tier IS NOT NULL) 
  OR 
  (type = 'credits' AND tier IS NULL AND credits IS NOT NULL)
)
```

### –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `credits` –∏ `tier` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è `subscription_tier`
- ‚úÖ Webhook'–∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π constraint

## üöÄ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### Vercel
- **–î–æ–º–µ–Ω:** https://kipish.fun
- **–°—Ç–∞—Ç—É—Å:** ‚óè Ready (Production)
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π:** a149ba7

### Supabase
- **URL:** https://ndrdksmdkhljymuvxjly.supabase.co
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- **Constraint:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** https://kipish.fun
2. **–ö—É–ø–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É Light (1‚Ç¥)**:
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å
   - –ù–∞–∂–º–∏—Ç–µ "–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
   - –í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É "Subscription (Best Value)"
   - –ö—É–ø–∏—Ç–µ "Light (Promo)"
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å
   - –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "Light" –≤–º–µ—Å—Ç–æ "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π"

### SQL –ø—Ä–æ–≤–µ—Ä–∫–∞:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å constraint:
SELECT 
    con.conname AS constraint_name,
    pg_get_constraintdef(con.oid) AS constraint_definition
FROM pg_constraint con
JOIN pg_class rel ON rel.oid = con.conrelid
WHERE rel.relname = 'payments' AND con.conname = 'check_payment_type';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∏:
SELECT * FROM payments 
WHERE type = 'subscription' 
ORDER BY created_at DESC 
LIMIT 5;
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞ (constraint –∏–∑–º–µ–Ω—ë–Ω)
- ‚úÖ –°—Ç–∞—Ä—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
- ‚úÖ –ù–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –∫—É–ø–∏—Ç—å –ü–û–î–ü–ò–°–ö–£, –∞ –Ω–µ –ø–∞–∫–µ—Ç –∫—Ä–µ–¥–∏—Ç–æ–≤!

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase Edge Functions
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `payments` –≤ Supabase

---

**–î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ!** ‚úÖ
